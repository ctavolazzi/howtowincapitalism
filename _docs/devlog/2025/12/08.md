# Devlog: December 8, 2025

**Time:** 3:19 PM - 3:30 PM PST
**Session:** Decision Matrix Tool Integration

---

## Summary

Added a Decision Matrix utility to the project—a quantitative decision-making tool for comparing options against weighted criteria. Originally provided as Python code from another project, converted to TypeScript and integrated with an Astro component for web rendering.

## What Was Built

### Files Created

| File | Lines | Purpose |
|------|-------|---------|
| `src/lib/tools/decision-matrix.ts` | 924 | Core logic: 4 analysis methods, scoring, recommendations |
| `src/lib/tools/index.ts` | 15 | Central exports |
| `src/components/molecules/DecisionMatrix.astro` | ~220 | Web renderer in Wikipedia style |

### Capabilities

- **4 analysis methods:** weighted, normalized, ranking, best-worst scaling
- **Automatic analysis:** strength/weakness identification, confidence scoring
- **Recommendation generation:** contextual advice based on score gaps
- **Web integration:** renders in the site's Wikipedia aesthetic

## Key Decisions Made

### 1. Folder Naming: `tools/` not `utils/`

**Decision:** Named the folder `tools/` instead of the more common `utils/`.

**Rationale:** Cross-project consistency. In the user's other codebases:
- `scripts/` = shell automation
- `tools/` = reusable programmatic utilities
- `snippets/` = code fragments

This distinction carries semantic meaning across projects.

**Implication:** Establishes a naming convention that can scale. Future utilities (calculators, analyzers, formatters) have a clear home.

### 2. TypeScript Conversion

**Decision:** Converted Python → TypeScript rather than keeping Python or creating a separate tooling layer.

**Rationale:**
- Project is Astro/TypeScript
- Enables direct import in `.astro` and `.mdx` files
- Single language stack reduces cognitive overhead

**Implication:** The tool is a first-class citizen of the codebase, not an external dependency. Can be extended, typed, and maintained alongside the site.

### 3. Dual Output: Logic + Component

**Decision:** Created both:
- `decision-matrix.ts` — pure logic, CLI-style output methods
- `DecisionMatrix.astro` — web renderer component

**Rationale:** The original Python code had `toString()` methods outputting formatted text with emojis and fixed-width columns—designed for terminal output. A static wiki needs HTML rendering.

**Implication:** Separation of concerns. The logic layer is reusable (could be called from build scripts, tests, or other contexts). The component layer handles presentation. This is the Adapter pattern in action.

## Mistakes Made & Corrected

### Bug 1: Stale Import Path in Comment

**Error:** Line 8 of `decision-matrix.ts` referenced `../lib/utils/` after renaming to `tools/`.

**Caught by:** Self-review when user asked "review everything and tell me why it's wrong."

**Lesson:** Comments rot faster than code. After refactoring, grep for old names.

### Bug 2: Destructuring Strings as Tuples

**Error:**
```javascript
// Created array of strings
const rankedOptions = result.rankings.map(([opt]) => opt);
// ["401k", "Roth IRA", "Taxable"]

// Then tried to destructure as tuples - WRONG
rankedOptions.map(([option, totalScore], idx) => {
// option = "4", totalScore = "0" — garbage!
```

**Caught by:** User asked to "recap and check for mistakes." Manual code review found the type mismatch.

**Lesson:**
1. The pattern *looked* correct at a glance
2. TypeScript's type inference didn't catch it (no strict mode, Astro frontmatter)
3. This would have rendered garbage data in production
4. **Actually running the code** would have caught this immediately

**Implication:** For complex components, write a test case or manually verify rendering before considering it "done."

## Broader Implications

### For This Project

The Decision Matrix tool fits the project's stated purpose: "a satirical but practical wiki about financial autonomy."

Potential uses:
- Comparing investment vehicles (401k vs Roth IRA vs taxable)
- Evaluating job offers
- Analyzing side hustle options
- Rent vs buy decisions

The tool transforms subjective comparisons into structured analysis—exactly what "winning capitalism" requires.

### For Development Process

This session demonstrated a productive pattern:

1. **User provides artifact** (Python code)
2. **AI adapts to context** (convert to TS, integrate with architecture)
3. **User challenges** ("show me the alternative," "tell me why it's wrong")
4. **AI self-corrects** (finds bugs, improves approach)
5. **User validates** ("recap what we did")

The back-and-forth caught two bugs that would have shipped otherwise. The "review your work" prompt is valuable.

### On Tool Quality

924 lines of TypeScript for a decision matrix is substantial. Questions to consider:

- **Is it over-engineered?** Four analysis methods, confidence scoring, strength/weakness detection—possibly more than needed for a wiki.
- **Is it under-tested?** No unit tests written. The component has a latent bug that was caught only by manual review.
- **Is it documented enough?** JSDoc comments exist, but no README in the tools folder.

**Recommendation:** If this tool sees real use, add:
1. A `tools/README.md` explaining each method
2. At least one integration test
3. An example MDX page demonstrating all features

## Files Changed

```
_docs/DEVLOG.md                                    # Updated
src/lib/tools/decision-matrix.ts                   # Created
src/lib/tools/index.ts                             # Created
src/components/molecules/DecisionMatrix.astro      # Created
src/components/index.ts                            # Updated (added export)
```

## Next Steps

- [x] ~~Create example MDX page using DecisionMatrix component~~ ✅ Done (`protocol/decision-matrix.mdx`)
- [x] ~~Consider adding `tools/README.md`~~ ✅ Done
- [ ] Verify component renders correctly in browser (not just lint-clean)
- [ ] Evaluate if all 4 analysis methods are needed or if 1-2 would suffice

---

*Session ended: 3:30 PM PST*

---

## Session 2b: Process Automation (3:30 PM - 3:45 PM)

Following a conversation audit, identified repeatable patterns and created automation scripts.

### What Was Built

| File | Purpose |
|------|---------|
| `.private/session-preflight.mjs` | Start-of-session context gathering |
| `.private/session-postflight.mjs` | End-of-session validation + devlog |
| `.private/security-checkup.mjs` | Security audit (secrets, gitignore) |
| `.private/WORKFLOW.md` | Crystallized process documentation |
| `.private/README.md` | Tool usage guide |
| `src/lib/tools/README.md` | Decision matrix documentation |

### Gitignore Updates

Added to `.gitignore`:
- `_work_efforts/` — Local task tracking (Johnny Decimal)
- `.private/` — Admin scripts and sensitive tools
- `_local/`, `*.local.md` — Local notes

### Patterns Automated

| User Pattern | Now Automated By |
|--------------|------------------|
| "Check the date" | `session-preflight.mjs` |
| "Check work_efforts" | `session-preflight.mjs` |
| "Update devlog" | `session-postflight.mjs --devlog` |
| "Security check" | `security-checkup.mjs` |
| "Review compliance" | `session-preflight.mjs` compliance checklist |

### Workflow Crystallized

```
START:  node .private/session-preflight.mjs
WORK:   ... implement, self-review ...
END:    node .private/session-postflight.mjs --devlog "summary"
VERIFY: node .private/security-checkup.mjs
```

---

*Session 2b ended: 3:45 PM PST*

---

## Session 2c: Documentation (3:45 PM - 4:00 PM)

Updated project documentation to reflect all new tools and establish developer guidelines.

### Files Created

| File | Lines | Purpose |
|------|-------|---------|
| `DEVELOPERS.md` | ~500 | Comprehensive developer guide |

### Files Updated

| File | Changes |
|------|---------|
| `README.md` | Added tools section, project structure, tech stack |
| `_docs/ARCHITECTURE.md` | Added tools documentation, DecisionMatrix component |
| `_docs/README.md` | Added links to new documentation |

### Documentation Map

```
/README.md              ← Quick start (users)
/DEVELOPERS.md          ← Full dev guide (contributors)
/_docs/
  ├── ARCHITECTURE.md   ← System design
  ├── DEVLOG.md         ← Development history
  └── README.md         ← Docs index
/src/lib/tools/README.md ← Tool API reference
```

### DEVELOPERS.md Contents

- Getting Started (prerequisites, installation)
- Architecture Overview (tech stack, directory structure)
- Component System (atomic design, creating components)
- Tools & Utilities (decision matrix, adding new tools)
- Content Authoring (MDX format, using components)
- Styling Guide (design tokens, CSS rules)
- Testing & Quality (build validation, checklist)
- Deployment (one-command deploy, CI/CD)
- Conventions (git commits, file naming, code style)

---

*Session 2c ended: 4:00 PM PST*

---

## Session 2d: Development Logger (4:15 PM - 4:25 PM)

Created a development logging system for debugging and session tracking.

### Architecture Decision

Evaluated 5 options for logger placement:

1. `src/lib/logger.ts` — Mixes dev tooling with source
2. `scripts/logger.mjs` — Logs buried in scripts
3. **`_dev/` folder** ← Selected
4. `_logs/` with embedded logger — Unusual structure
5. `_tools/` folder — Deeper nesting

**Chose Option 3 (`_dev/`)** because:
- Follows `_docs` pattern already established
- Clear that it's development tooling, not production
- Flat structure - not over-nested
- Easy to add more dev tools later
- Underscore prefix = obviously not deployed

### Files Created

| File | Lines | Purpose |
|------|-------|---------|
| `_dev/logger.mjs` | ~340 | Logger module |
| `_dev/logger.config.json` | 17 | Configuration |
| `_dev/README.md` | ~100 | Documentation |
| `_dev/logs/.gitkeep` | 1 | Keep folder in git |

### Logger Features

| Feature | Description |
|---------|-------------|
| Log levels | debug, info, warn, error, success |
| Session tracking | start/end with duration measurement |
| File operations | created/modified/deleted logging |
| Error logging | With stack traces |
| Scoped loggers | `createLogger('scope')` |
| Dual output | Console (colored) + file |
| Auto-cleanup | Old logs deleted after configurable days |
| Configurable | Toggle, levels, format (pretty/JSON) |

### Usage

```javascript
import { log, logSession, logFile, logError } from './_dev/logger.mjs';

log.info('Message');
logSession.start('Task');
logFile.created('file.ts');
logSession.end('Task');  // Shows duration
```

### Git Strategy

| Path | Git Status | Reason |
|------|------------|--------|
| `_dev/` | Tracked | Shared with team |
| `_dev/logs/*.log` | Ignored | Local only |

---

*Session 2d ended: 4:25 PM PST*

---

## Full Session Summary

### Total Files Created

| Category | Files | Lines |
|----------|-------|-------|
| Tools | `decision-matrix.ts`, `index.ts`, `README.md` | ~950 |
| Components | `DecisionMatrix.astro` | ~220 |
| Content | `protocol/decision-matrix.mdx` | ~100 |
| Documentation | `DEVELOPERS.md`, updates to 4 docs | ~600 |
| Process Automation | 3 scripts in `.private/` | ~500 |
| Dev Logger | `logger.mjs`, config, README | ~460 |
| **Total** | **~15 files** | **~2,800 lines** |

### Commits

```
46d43ab feat: add Decision Matrix tool and documentation
9ffea2d docs: add DEVELOPERS.md and update documentation
6d89042 style: fix trailing whitespace in DEVELOPERS.md
```

### Bugs Caught & Fixed

1. Stale import path in comment (`utils/` → `tools/`)
2. Destructuring strings as tuples in DecisionMatrix.astro
3. Duplicate "Naming Decision" text in DEVLOG.md

### Patterns Established

| Pattern | Location |
|---------|----------|
| Tools go in `src/lib/tools/` | TypeScript utilities |
| Dev tooling goes in `_dev/` | Shared dev tools |
| Private scripts go in `.private/` | Local-only admin |
| Session workflow | preflight → work → postflight |

### Key Decisions Made

1. **`tools/` not `utils/`** — Cross-project consistency
2. **TypeScript conversion** — Match project stack
3. **Dual output (logic + component)** — Separation of concerns
4. **`_dev/` for shared dev tools** — Follows `_docs` pattern
5. **`.private/` gitignored, `_dev/` tracked** — Different sharing needs

---

*Session 2d ended: 4:25 PM PST*

---

## Session 2e: Decision Matrix Tests (4:45 PM - 4:55 PM)

Used our own Decision Matrix tool to decide what to work on next—chose to write tests.

### Meta: Eating Our Own Dogfood

Ran the Decision Matrix against 4 options:

| Option | Score | Notes |
|--------|-------|-------|
| Tests for Decision Matrix | 8.05 (100%) | High impact + foundation |
| Build Another Tool | 7.85 (97.5%) | Statistical tie |
| Add Components | 7.10 (88.2%) | Good balance |
| Expand Content/Docs | 6.15 (76.4%) | Quick but less foundational |

**Winner:** Tests — validates the tool, establishes testing patterns.

### What Was Built

| File | Lines | Purpose |
|------|-------|---------|
| `src/lib/tools/decision-matrix.test.ts` | ~420 | Comprehensive test suite |
| `package.json` | +2 lines | Added test scripts |

### Test Coverage

| Category | Tests | Coverage |
|----------|-------|----------|
| DecisionMatrix constructor | 6 | Input validation, error cases |
| analyze() method | 5 | Result structure, rankings |
| Weighted method | 3 | Default/custom weights, breakdown |
| Normalized method | 2 | 0-100 scaling |
| Ranking method | 2 | Score-to-rank conversion |
| Best-worst method | 1 | Scaling verification |
| DecisionResult class | 8 | toString, toJSON, comparison table |
| makeDecision() | 4 | Single/multi method, topN |
| compareMethods() | 3 | Method comparison output |
| Real-world scenarios | 5 | Languages, ties, single option |
| Edge cases | 6 | Decimals, zeros, negatives, specials |
| Strengths/Weaknesses | 3 | Non-overlapping identification |
| Why Winner Won | 2 | Explanation generation |
| **Total** | **52** | **All passing** |

### Dependencies Added

```json
"devDependencies": {
  "vitest": "^4.0.15"
}
```

### Scripts Added

```json
"scripts": {
  "test": "vitest run",
  "test:watch": "vitest"
}
```

### Bug Fixed

**Import missing:** Forgot to import `beforeEach` from Vitest.

```typescript
// Before
import { describe, it, expect } from 'vitest';

// After
import { describe, it, expect, beforeEach } from 'vitest';
```

### Patterns Established

| Pattern | Example |
|---------|---------|
| Test file naming | `*.test.ts` adjacent to source |
| Test structure | describe → it → expect |
| Test categories | Constructor, methods, scenarios, edge cases |
| Real-world testing | Use actual use cases (programming languages) |

### Verification

```bash
npm test
# ✓ 52 tests passing in 173ms
```

---

*Session 2e ended: 4:55 PM PST*

---

## Full Day Summary

| Session | Time | What | Files |
|---------|------|------|-------|
| 2a | 3:19 PM | Decision Matrix tool + component | 3 |
| 2b | 3:30 PM | Process automation (.private scripts) | 5 |
| 2c | 3:45 PM | Documentation (DEVELOPERS.md) | 4 updated |
| 2d | 4:15 PM | Development logger (_dev/) | 4 |
| 2e | 4:45 PM | Test suite for Decision Matrix | 2 |
| **Total** | ~2 hours | Full-featured tooling | **~18 files** |

### Test Stats

- **52 tests** covering all public APIs
- **173ms** execution time
- **100%** pass rate

*Full day ended: 4:55 PM PST*

---

## Session 3: Header Redesign & v1.0.0 Release (6:00 PM - 6:15 PM)

**Major breakthrough:** Finally cracked the CSS box model for Astro/Starlight.

### The Problem

The header component was trapped inside Starlight's wrapper divs. Using `position: sticky` and `width: 100%` gave us 100% of the *parent container*, not the viewport. Result: misaligned layouts, content bleeding through the nav menu, inconsistent widths.

### The Solution

**Key insight:** `position: fixed` escapes the parent container and attaches directly to the viewport.

| Property | Before (broken) | After (working) |
|----------|-----------------|-----------------|
| `position` | `sticky` | `fixed` |
| `width` | `100%` | (implied by `left: 0; right: 0`) |
| Content push | None | `header-spacer` div |

### Box Model Structure (Final)

```
VIEWPORT (browser window)
│
├── header.header-wrap          ← FIXED to viewport
│   │                             top: 0, left: 0, right: 0
│   │                             height: 60px, z-index: 10000
│   │
│   └── div.header-content      ← CENTERED (max-width: 1200px)
│       │                         padding: 0 16px
│       │
│       └── div.header-row      ← FLEXBOX (space-between)
│           │
│           ├── a.title         ← LEFT (flex: 1 1 auto)
│           │
│           └── div.actions     ← RIGHT (flex: 0 0 auto)
│               ├── Search      
│               └── Menu button
│
├── nav.nav-menu                ← FIXED overlay (when open)
│   │                             top: 60px, left/right/bottom: 0
│   │
│   └── div.nav-content         ← Same bounds as header-content
│       └── ul.nav-list         
│
└── div.header-spacer           ← Compensates for fixed header
                                  height: 60px
```

### CSS Custom Properties

```css
:root {
  --header-height: 60px;
  --header-padding: 16px;
  --header-bg: #ffffff;
  --header-border: #e0e0e0;
  --text-color: #202122;
  --link-color: #0645ad;
  --hover-bg: #f5f5f5;
}
```

### Key Technical Decisions

| Decision | Rationale |
|----------|-----------|
| `position: fixed` over `sticky` | Escapes Starlight's wrapper, attaches to viewport |
| `left: 0; right: 0` over `width: 100%` | Works regardless of parent width |
| CSS custom properties | Single source of truth for dimensions |
| `hidden` attribute over CSS class | Native HTML, cleaner JavaScript |
| Spacer div | Fixed positioning removes header from flow |
| `flex: 0 0 auto` on actions | Prevents search/menu from shrinking |
| `clamp()` for font-size | Responsive without media queries |

### Files Changed

| File | Changes |
|------|---------|
| `src/components/overrides/Header.astro` | Complete rewrite with proper box model |
| `src/styles/custom.css` | Updated search button styling |
| `astro.config.mjs` | Already had component overrides |
| `package.json` | Version bump 0.0.1 → 1.0.0 |

### Features Added

- ✅ Full viewport-width header (edge to edge)
- ✅ Title + controls properly aligned
- ✅ Menu opens as full-screen overlay
- ✅ No content bleeding through
- ✅ Escape key closes menu
- ✅ Clicking nav link closes menu
- ✅ CSS custom properties for theming
- ✅ Responsive title sizing with `clamp()`

### Lessons Learned

1. **`position: fixed` is the escape hatch** — When you're inside a framework's wrapper and need true viewport positioning, `fixed` is the answer.

2. **The spacer pattern** — Fixed elements leave a void in document flow. A spacer div with matching height is the cleanest solution.

3. **`left: 0; right: 0` > `width: 100%`** — The former is viewport-relative, the latter is parent-relative.

4. **Don't fight the framework** — Instead of trying to make Starlight's structure work, we replaced the component entirely and controlled our own DOM.

### Version Bump

**0.0.1 → 1.0.0**

Rationale: First stable, publicly usable version with:
- Working navigation
- Clean header design
- Test coverage
- Documentation

---

*Session 3 ended: 6:15 PM PST*

---

## Day Total

| Session | Focus | Key Deliverable |
|---------|-------|-----------------|
| 2a | Decision Matrix | 924-line tool |
| 2b | Process automation | .private scripts |
| 2c | Documentation | DEVELOPERS.md |
| 2d | Dev logger | _dev/logger.mjs |
| 2e | Testing | 52 tests |
| **3** | **Header redesign** | **v1.0.0 release** |

*Full day ended: 6:15 PM PST*
