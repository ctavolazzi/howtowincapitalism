---
/**
 * @fileoverview Call-to-action molecule for monetization and external links.
 *
 * A promotional box for book sales, courses, and other external content.
 * Includes URL sanitization to prevent javascript: protocol injection.
 *
 * Design Patterns:
 * - Composite: Composed of WikiBox atom with CTA variant
 * - Strategy: Configurable href for different destinations
 *
 * @module components/molecules/CallToAction
 * @see {@link module:components/atoms/WikiBox} - Container component
 * @see {@link module:lib/constants} - Default link destinations
 *
 * @example
 * ```astro
 * <CallToAction title="Get the Book" price="$19" />
 * <CallToAction
 *   title="Premium Course"
 *   buttonText="Enroll Now"
 *   href="https://example.com/course"
 *   price="$99"
 * >
 *   <p>Learn advanced strategies</p>
 * </CallToAction>
 * ```
 *
 * @author How To Win Capitalism Team
 * @since 1.0.0
 */
import WikiBox from '../atoms/WikiBox.astro';
import { LINKS } from '../../lib/constants';

export interface Props {
  title: string;
  buttonText?: string;
  href?: string;
  price?: string;
}

const {
  title,
  buttonText = 'Learn More',
  href = LINKS.gumroad,
  price
} = Astro.props;

// Security: Validate URL to prevent javascript: protocol injection
function sanitizeUrl(url: string): string {
  const trimmed = url.trim().toLowerCase();
  if (trimmed.startsWith('javascript:') || trimmed.startsWith('data:') || trimmed.startsWith('vbscript:')) {
    return '#';
  }
  return url;
}

const safeHref = sanitizeUrl(href);
---

<WikiBox variant="cta" title={title} class="cta">
  <slot />
  {price && <p class="cta__price">{price}</p>}
  <a href={safeHref} class="cta__button" target="_blank" rel="noopener noreferrer">
    {buttonText}
  </a>
</WikiBox>

<style>
  .cta__price {
    text-align: center;
    font-size: 1.25em;
    font-weight: bold;
    margin: var(--space-sm) 0;
  }

  .cta__button {
    display: block;
    text-align: center;
    background: var(--color-link);
    color: var(--color-bg);
    padding: var(--space-md) var(--space-lg);
    margin-top: var(--space-md);
    font-weight: 600;
    text-decoration: none;
  }

  .cta__button:hover {
    opacity: 0.9;
  }
</style>
