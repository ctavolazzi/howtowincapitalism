---
/**
 * @fileoverview Disclaimer banner molecule with dismissal persistence.
 *
 * A closable warning banner that remembers dismissal state in localStorage.
 * Used to display site-wide disclaimers about financial advice.
 *
 * Design Patterns:
 * - Composite: Composes WikiBox with warning variant
 * - Decorator: Adds close functionality to WikiBox
 *
 * @module components/molecules/Disclaimer
 * @see {@link module:components/atoms/WikiBox} - Container component
 * @see {@link module:lib/constants} - Default disclaimer text
 *
 * @example
 * ```astro
 * <Disclaimer />
 * <Disclaimer text="Custom warning message" />
 * <Disclaimer id="custom-disclaimer" text="Specific warning" />
 * ```
 *
 * @author How To Win Capitalism Team
 * @since 1.0.0
 */
import WikiBox from '../atoms/WikiBox.astro';
import { DEFAULTS } from '../../lib/constants';

export interface Props {
  text?: string;
  id?: string;
}

const { text = DEFAULTS.disclaimer, id = 'site-disclaimer' } = Astro.props;
---

<div class="disclaimer-wrapper" data-disclaimer-id={id}>
  <WikiBox variant="warning" padding="md">
    <div class="disclaimer-content">
      <div class="disclaimer-text">
        <strong>⚠️ DISCLAIMER:</strong> {text}
      </div>
      <button class="disclaimer-close" aria-label="Dismiss disclaimer" type="button">✕</button>
    </div>
  </WikiBox>
</div>

<!-- Styles in Base.astro -->

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Closable disclaimer with localStorage persistence
    document.querySelectorAll('.disclaimer-wrapper').forEach((wrapper) => {
      const id = wrapper.getAttribute('data-disclaimer-id');
      const storageKey = `disclaimer-dismissed-${id}`;

      // Check if already dismissed
      if (localStorage.getItem(storageKey) === 'true') {
        wrapper.setAttribute('hidden', '');
        return;
      }

      // Add close handler
      const closeBtn = wrapper.querySelector('.disclaimer-close');
      closeBtn?.addEventListener('click', () => {
        wrapper.setAttribute('hidden', '');
        localStorage.setItem(storageKey, 'true');
      });
    });
  });
</script>
