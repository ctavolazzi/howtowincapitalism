---
import Base from '../layouts/Base.astro';
import { TradeWidget } from '../components';
import Hero from '../components/organisms/Hero.astro';
---

<Base title="Home">
  <!-- Auth Gate: Redirect to login if not authenticated -->
  <div id="auth-gate" class="auth-gate">
    <div class="loading-spinner"></div>
    <p>Loading...</p>
  </div>

  <div id="content" style="display: none;">
  <Hero
    tagline="The game is rigged. Learn the rules anyway."
    subtitle="A satirical but practical wiki about financial autonomy. Notes on a system for people tired of the grind."
    ctaText="Start Reading"
    ctaLink="/faq/introduction/"
    showScrollIndicator={true}
  />


  <h2>FAQ</h2>
  <p>Core concepts and answers to common questions.</p>
  <ul>
    <li><a href="/faq/introduction/">Introduction</a> — Start here</li>
    <li><a href="/faq/compound-interest/">Compound Interest</a> — The engine of wealth</li>
    <li><a href="/faq/emergency-fund/">Emergency Fund</a> — Your first foundation</li>
    <li><a href="/faq/tax-advantaged-accounts/">Tax-Advantaged Accounts</a> — 401(k), IRA, HSA</li>
    <li><a href="/faq/debt-strategies/">Debt Strategies</a> — Avalanche vs Snowball</li>
  </ul>

  <h2>Notes</h2>
  <p>Research, analysis, and observations.</p>
  <ul>
    <li><a href="/notes/latest/">Latest Updates</a></li>
    <li><a href="/notes/automation/">Financial Automation</a></li>
    <li><a href="/notes/negotiation-tactics/">Negotiation Tactics</a></li>
  </ul>

  <h2>Tools</h2>
  <p>Templates and calculators.</p>
  <ul>
    <li><a href="/faq/decision-matrix/">Decision Matrix</a> — Quantitative decision tool</li>
    <li><a href="/tools/financial-autonomy-checklist/">Financial Autonomy Checklist</a></li>
  </ul>

  <h2>Trade With Me</h2>
  <TradeWidget />
  </div>

  <!-- Banner mode at bottom -->
  <TradeWidget mode="banner" />
</Base>

<script>
  import { checkAuth } from '../lib/auth/api-client';

  document.addEventListener('DOMContentLoaded', () => {
    const authGate = document.getElementById('auth-gate');
    const content = document.getElementById('content');

    async function verifyAuth() {
      const { authenticated } = await checkAuth();

      if (!authenticated) {
        window.location.href = '/login/';
      } else {
        if (authGate) authGate.style.display = 'none';
        if (content) content.style.display = 'block';
      }
    }

    verifyAuth();
  });
</script>

<style>
  .auth-gate {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    color: #72777d;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #eaecef;
    border-top-color: #0645ad;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
