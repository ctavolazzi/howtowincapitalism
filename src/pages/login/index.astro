---
/**
 * Login Page
 *
 * Simple login page with the LoginForm component.
 * Uses Base.astro layout for consistency.
 */
import Base from '../../layouts/Base.astro';
import LoginForm from '../../components/auth/LoginForm.astro';

// Get CSRF token from middleware
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const csrfToken = (Astro.locals as any).csrfToken as string | undefined;
---

<Base title="Log In" description="Access your profile and track your progress" hideNav={false}>
  <div class="auth-page">
    <div class="auth-header">
      <h1>Log In</h1>
      <p>Access your profile and track your progress</p>
    </div>

    <LoginForm csrfToken={csrfToken} />
  </div>
</Base>

<script>
  import { checkAuth } from '../../lib/auth/api-client';

  // If already logged in, redirect away from login page
  async function checkIfAlreadyLoggedIn() {
    const { authenticated } = await checkAuth();

    if (authenticated) {
      // Get redirect URL or default to home
      const params = new URLSearchParams(window.location.search);
      const redirect = params.get('redirect');
      if (redirect && redirect.startsWith('/') && !redirect.startsWith('//')) {
        window.location.href = redirect;
      } else {
        window.location.href = '/';
      }
    }
  }

  checkIfAlreadyLoggedIn();
</script>

<style>
  .auth-page {
    max-width: 500px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .auth-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .auth-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    margin-top: 0;
  }

  .auth-header p {
    color: var(--color-text-muted, #72777d);
    margin: 0;
  }

  @media (min-width: 640px) {
    .auth-page {
      padding: 3rem 2rem;
    }
  }
</style>
