---
/**
 * Base Layout - Simple, clean, yours.
 */
import HamburgerMenu from '../components/organisms/HamburgerMenu.astro';

export interface Props {
  title: string;
  description?: string;
  /** Hide navigation (for auth pages) */
  hideNav?: boolean;
}

const { title, description = 'A wiki about financial autonomy', hideNav = false } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>
  <title>{title} | How To Win Capitalism</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
</head>
<body>
  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-to-content">Skip to main content</a>

  <header>
    <nav>
      <a href="/" class="site-title">How To Win Capitalism</a>
      {!hideNav && (
        <HamburgerMenu />
      )}
    </nav>
  </header>

  <main id="main-content">
    <slot />
  </main>

  <footer>
    <div class="footer-disclaimer">
      <p><strong>Disclaimer:</strong> The content on this site is for informational and educational purposes only. Nothing here constitutes financial, investment, tax, or legal advice. I am not a licensed financial advisor, CPA, or attorney.</p>
      <p>All investments involve risk, including the possible loss of principal. Past performance does not guarantee future results. Always conduct your own research and consult with qualified professionals before making any financial decisions. You assume full responsibility for any actions you take based on information found on this site.</p>
    </div>
    <p class="copyright">
      &copy; {new Date().getFullYear()} How To Win Capitalism &middot;
      <a href="/disclaimer/">Full Disclaimer</a> &middot;
      <a href="/privacy/">Privacy</a> &middot;
      <a href="/terms/">Terms</a>
    </p>
  </footer>

  <!-- Cookie Consent -->
  <div id="cookie-consent" class="cookie-consent" hidden>
    <div class="cookie-message">
      <strong>Cookies:</strong> We use essential cookies for authentication, security, and remembering your preferences. No advertising or tracking cookies.
    </div>
    <button id="cookie-accept" type="button">Got it</button>
  </div>

  <!-- Activity Tracking -->
  <script>
    import { trackPageView, isAuthenticated } from '../lib/auth';

    // Track page view if user is logged in
    if (typeof window !== 'undefined') {
      // Small delay to ensure auth state is loaded
      setTimeout(() => {
        if (isAuthenticated()) {
          trackPageView(window.location.pathname);
        }
      }, 100);
    }
  </script>

  <!-- Cookie consent script - inline to ensure DOM is ready -->
  <!-- Uses sessionStorage: dismissed once per session, resets when tab closes -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      var storageKey = 'htwc_cookie_dismissed';
      var consentBanner = document.getElementById('cookie-consent');
      var consentButton = document.getElementById('cookie-accept');

      if (!consentBanner || !consentButton) return;

      function isDismissed() {
        // Use sessionStorage - resets when tab/browser closes
        return sessionStorage.getItem(storageKey) === 'true';
      }

      function dismiss() {
        sessionStorage.setItem(storageKey, 'true');
        consentBanner.hidden = true;
        consentBanner.style.display = 'none';
      }

      // Show banner if not dismissed this session
      if (!isDismissed()) {
        consentBanner.hidden = false;
      }

      consentButton.addEventListener('click', dismiss);
      consentButton.addEventListener('touchend', function(e) {
        e.preventDefault();
        dismiss();
      });
    });
  </script>
</body>
</html>

<style is:global>
  /* Reset */
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  /* Base + Design Tokens */
  :root {
    /* Colors */
    --color-bg: #ffffff;
    --color-text: #202122;
    --color-text-muted: #666;
    --color-link: #0645ad;
    --color-link-visited: #0b0080;
    --color-border: #a2a9b1;
    --color-surface: #f8f9fa;
    --color-surface-alt: #eaecef;

    /* Warning/Info */
    --color-warning-bg: #fef6e7;
    --color-warning-border: #fc3;
    --color-info-bg: #eaf3ff;
    --color-info-border: #36c;

    /* Typography */
    --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    --font-serif: Georgia, "Times New Roman", serif;

    /* Sizes */
    --text-xs: 0.75rem;
    --text-sm: 0.875rem;
    --text-base: 1rem;
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;

    /* Spacing */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;

    /* Borders */
    --border-width: 1px;
    --line-height: 1.6;
    --line-height-tight: 1.3;

    /* Shadows */
    --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.04);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.08), 0 4px 6px rgba(0, 0, 0, 0.05);

    /* Refined surfaces */
    --color-surface-elevated: #ffffff;
    --color-border-subtle: #e4e7eb;

    /* Layout */
    --max-width: 800px;
  }

  html {
    font-family: var(--font-sans);
    font-size: 16px;
    line-height: 1.6;
    color: var(--color-text);
    background: var(--color-bg);
  }

  /* Hide all scrollbars globally */
  * {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }

  *::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Typography */
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-serif);
    font-weight: 400;
    line-height: 1.3;
    margin: 1.5em 0 0.5em;
  }

  h1 { font-size: 2rem; }
  h2 { font-size: 1.5rem; border-bottom: 1px solid var(--color-border); padding-bottom: 0.25em; }
  h3 { font-size: 1.25rem; }

  p { margin: 1em 0; }

  a {
    color: var(--color-link);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  ul, ol {
    margin: 1em 0;
    padding-left: 2em;
  }

  code {
    background: var(--color-surface);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
  }

  pre {
    background: var(--color-surface);
    padding: 1em;
    overflow-x: auto;
    border-radius: 4px;
    margin: 1em 0;
  }

  pre code {
    background: none;
    padding: 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
  }

  th, td {
    border: 1px solid var(--color-border);
    padding: 0.5em;
    text-align: left;
  }

  th {
    background: var(--color-surface);
  }

  /* Layout */
  header {
    border-bottom: 1px solid var(--color-border-subtle, #e4e7eb);
    padding: 1rem;
    background: var(--color-surface-elevated, #ffffff);
    box-shadow: var(--shadow-xs, 0 1px 2px rgba(0, 0, 0, 0.04));
  }

  header nav {
    max-width: var(--max-width);
    margin: 0 auto;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 1rem;
  }

  header .site-title {
    font-family: var(--font-serif);
    font-size: 1.25rem;
    font-weight: 400;
    color: var(--color-text);
  }

  main {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  footer {
    border-top: 1px solid var(--color-border-subtle, #e4e7eb);
    padding: 2rem 1rem;
    color: var(--color-text-muted, #666);
    font-size: 0.875rem;
    background: var(--color-surface, #f8f9fa);
  }

  .footer-disclaimer {
    max-width: var(--max-width);
    margin: 0 auto 1.5rem;
    padding: 1.25rem;
    background: var(--color-surface-alt, #eaecef);
    border: 1px solid var(--color-border-subtle, #e4e7eb);
    border-radius: 6px;
    font-size: 0.8rem;
    line-height: 1.6;
    text-align: left;
    box-shadow: var(--shadow-xs, 0 1px 2px rgba(0, 0, 0, 0.04));
  }

  .footer-disclaimer p {
    margin: 0 0 0.75rem 0;
  }

  .footer-disclaimer p:last-child {
    margin-bottom: 0;
  }

  .copyright {
    text-align: center;
    margin: 0;
  }

  .copyright a {
    color: var(--color-link);
    transition: color 0.2s ease-out;
  }

  .copyright a:hover {
    color: #053a92;
  }

  .cookie-consent {
    position: fixed;
    bottom: var(--space-md);
    left: 50%;
    transform: translateX(-50%);
    max-width: 720px;
    width: calc(100% - 2 * var(--space-md));
    background: var(--color-surface-elevated, #ffffff);
    color: var(--color-text);
    border: 1px solid var(--color-border-subtle, #e4e7eb);
    border-radius: 6px;
    z-index: 9999;
    padding: var(--space-md);
    display: flex;
    gap: var(--space-md);
    align-items: center;
    box-shadow: var(--shadow-lg, 0 10px 15px rgba(0, 0, 0, 0.08), 0 4px 6px rgba(0, 0, 0, 0.05));
    z-index: 1000;
  }

  .cookie-consent .cookie-message {
    flex: 1;
    font-size: var(--text-sm);
  }

  .cookie-consent button {
    background: var(--color-link);
    color: #fff;
    border: none;
    padding: 0.5rem 0.9rem;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
  }

  .cookie-consent button:hover {
    background: #053a92;
  }


  /* === Component Styles === */

  /* Breadcrumbs */
  .breadcrumbs {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-md);
  }

  .breadcrumbs__list {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: var(--space-xs);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .breadcrumbs__item {
    display: inline-flex;
    align-items: baseline;
    gap: var(--space-xs);
  }

  .breadcrumbs__separator {
    color: var(--color-text-muted);
  }

  .breadcrumbs__link {
    color: var(--color-link);
  }

  .breadcrumbs__link:visited {
    color: var(--color-link-visited);
  }

  .breadcrumbs__current {
    color: var(--color-text);
  }

  /* WikiBox */
  .wiki-box {
    display: flex;
    flex-direction: column;
    background: var(--color-bg);
    border: var(--border-width) solid var(--color-border);
    margin: var(--space-lg) 0;
  }

  .wiki-box__header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    background: var(--color-surface);
    padding: var(--space-md);
    border-bottom: var(--border-width) solid var(--color-border);
    font-weight: 600;
  }

  .wiki-box__title { flex: 1; }
  .wiki-box__body { padding: var(--space-md); }

  .wiki-box--padding-none .wiki-box__body { padding: 0; }
  .wiki-box--padding-sm .wiki-box__body { padding: var(--space-sm); }
  .wiki-box--padding-lg .wiki-box__body { padding: var(--space-lg); }

  .wiki-box--warning {
    background: var(--color-warning-bg);
    border-color: var(--color-warning-border);
    border-left-width: 4px;
  }

  .wiki-box--info {
    background: var(--color-info-bg);
    border-color: var(--color-info-border);
  }

  /* Disclaimer */
  .disclaimer-wrapper {
    position: relative;
  }

  .disclaimer-wrapper[hidden] {
    display: none;
  }

  .disclaimer-content {
    display: flex;
    align-items: flex-start;
    gap: var(--space-md);
    padding-right: 2rem;
  }

  .disclaimer-text {
    flex: 1;
  }

  .disclaimer-close {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    background: none;
    border: none;
    color: #000;
    cursor: pointer;
    font-size: 1.25rem;
    font-weight: bold;
    padding: 0.25rem 0.5rem;
    opacity: 0.6;
  }

  .disclaimer-close:hover {
    opacity: 1;
  }

  /* Topic Cards */
  .topic-card {
    display: block;
    text-decoration: none;
    color: inherit;
    border: 1px solid var(--color-border-subtle, #e4e7eb);
    border-radius: 8px;
    padding: var(--space-md) var(--space-lg);
    background: var(--color-surface, #f8f9fa);
    transition: all 0.2s ease-out;
    position: relative;
    box-shadow: var(--shadow-xs, 0 1px 2px rgba(0, 0, 0, 0.04));
  }

  .topic-card:hover {
    border-color: var(--color-link, #0645ad);
    background: var(--color-surface-elevated, #ffffff);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md, 0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.04));
  }

  .topic-card__inner {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .topic-card__header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: wrap;
  }

  .topic-card__tag {
    display: inline-block;
    background: #333;
    color: white;
    font-size: 0.6rem;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 700;
  }

  .topic-card__title {
    font-family: var(--font-serif);
    font-size: 1.1rem;
    font-weight: 400;
    margin: 0;
    color: var(--color-link);
  }

  .topic-card:hover .topic-card__title {
    text-decoration: underline;
  }

  .topic-card__description {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    margin: 0;
    line-height: 1.5;
  }

  /* Arrow indicator */
  .topic-card::after {
    content: "â†’";
    position: absolute;
    right: var(--space-lg);
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-link);
    font-size: 1.25rem;
    opacity: 0.5;
    transition: opacity 0.15s;
  }

  .topic-card:hover::after {
    opacity: 1;
  }

  /* Card Grid */
  .card-grid {
    display: grid;
    width: 100%;
    gap: var(--space-sm);
    grid-template-columns: 1fr;
  }

  @media (min-width: 640px) {
    .card-grid { grid-template-columns: repeat(2, 1fr); }
  }

  .card-grid .topic-card {
    margin: 0;
  }

  /* See Also */
  .see-also {
    margin: var(--space-xl) 0;
    padding-top: var(--space-lg);
    border-top: var(--border-width) solid var(--color-border-subtle, #e4e7eb);
  }

  .see-also__title {
    font-family: var(--font-serif);
    font-size: var(--text-xl);
    font-weight: 400;
    margin: 0 0 var(--space-md) 0;
    padding-bottom: var(--space-xs);
    border-bottom: var(--border-width) solid var(--color-border);
  }

  .see-also__list {
    list-style: disc;
    margin: 0;
    padding-left: var(--space-xl);
  }

  .see-also__item {
    margin-bottom: var(--space-sm);
  }

  .see-also__link {
    color: var(--color-link);
  }

  .see-also__link:visited {
    color: var(--color-link-visited);
  }

  .see-also__description {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
  }

  /* First h1 shouldn't have top margin */
  main > article > h1:first-child,
  main > h1:first-child {
    margin-top: 0;
  }

  /* Skip to content link */
  .skip-to-content {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--color-link, #0645ad);
    color: #fff;
    padding: 0.5rem 1rem;
    text-decoration: none;
    z-index: 10000;
    border-radius: 0 0 4px 0;
  }

  .skip-to-content:focus {
    top: 0;
  }

  /* Consolidated Button Styles */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm, 0.5rem);
    padding: 0.75rem 1.5rem;
    font-family: inherit;
    font-size: var(--text-base, 1rem);
    font-weight: 600;
    line-height: 1.5;
    text-align: center;
    text-decoration: none;
    border: 2px solid transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease-out;
    min-height: 44px; /* Touch target minimum */
  }

  .btn-primary {
    background: var(--color-link, #0645ad);
    color: #ffffff;
    border-color: var(--color-link, #0645ad);
  }

  .btn-primary:hover:not(:disabled) {
    background: #053a92;
    border-color: #053a92;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(6, 69, 173, 0.2);
  }

  .btn-primary:active:not(:disabled) {
    transform: translateY(0);
  }

  .btn-secondary {
    background: var(--color-surface, #f8f9fa);
    color: var(--color-text, #202122);
    border-color: var(--color-border, #a2a9b1);
  }

  .btn-secondary:hover:not(:disabled) {
    background: var(--color-surface-alt, #eaecef);
    border-color: var(--color-text-muted, #666);
  }

  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .btn:focus-visible {
    outline: 2px solid var(--color-link, #0645ad);
    outline-offset: 2px;
  }

  /* Consolidated Form Styles */
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
  }

  .form-group:last-child {
    margin-bottom: 0;
  }

  .form-label {
    font-weight: 600;
    font-size: var(--text-sm, 0.875rem);
    color: var(--color-text, #202122);
  }

  .form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--color-border, #a2a9b1);
    border-radius: 6px;
    font-size: var(--text-base, 1rem);
    font-family: inherit;
    background: var(--color-bg, #ffffff);
    color: var(--color-text, #202122);
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .form-input:focus {
    outline: none;
    border-color: var(--color-link, #0645ad);
    box-shadow: 0 0 0 3px rgba(6, 69, 173, 0.1);
  }

  .form-input:invalid:not(:focus):not(:placeholder-shown) {
    border-color: #dc2626;
  }

  .form-hint {
    color: var(--color-text-muted, #72777d);
    font-size: var(--text-xs, 0.75rem);
    line-height: 1.4;
  }

  .form-error {
    padding: 0.5rem 0.75rem;
    background: #fee;
    border: 1px solid #dc2626;
    border-radius: 4px;
    color: #dc2626;
    font-size: var(--text-sm, 0.875rem);
    line-height: 1.4;
  }

  /* Improve link transitions */
  a {
    transition: color 0.2s ease-out, text-decoration-color 0.2s ease-out;
  }

  /* Improve focus states for navigation */
  header a:focus-visible {
    outline: 2px solid var(--color-link, #0645ad);
    outline-offset: 2px;
    border-radius: 2px;
  }


  @media print {
    .breadcrumbs { display: none; }
    .skip-to-content { display: none; }
  }

  @media (prefers-reduced-motion: reduce) {
    .btn:hover:not(:disabled),
    .topic-card:hover,
    .cookie-consent button:hover {
      transform: none;
    }
    a,
    .topic-card,
    .cookie-consent button {
      transition: none;
    }
  }
</style>
