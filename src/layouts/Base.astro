---
/**
 * Base Layout - Simple, clean, yours.
 */
import UserMenu from '../components/auth/UserMenu.astro';
import GlobalSearch from '../components/search/GlobalSearch.astro';

export interface Props {
  title: string;
  description?: string;
}

const { title, description = 'A wiki about financial autonomy' } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>
  <title>{title} | How To Win Capitalism</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
</head>
<body>
  <header>
    <nav>
      <a href="/" class="site-title">How To Win Capitalism</a>
      <ul>
        <li><a href="/faq/" class:list={{ active: currentPath.startsWith('/faq/') }}>FAQ</a></li>
        <li><a href="/notes/" class:list={{ active: currentPath.startsWith('/notes/') }}>Notes</a></li>
        <li><a href="/tools/" class:list={{ active: currentPath.startsWith('/tools/') }}>Tools</a></li>
      </ul>
      <div class="nav-actions">
        <GlobalSearch compact />
      </div>
    </nav>
  </header>

  <main>
    <slot />
  </main>

  <footer>
    <div class="footer-disclaimer">
      <p><strong>Disclaimer:</strong> The content on this site is for informational and educational purposes only. Nothing here constitutes financial, investment, tax, or legal advice. I am not a licensed financial advisor, CPA, or attorney.</p>
      <p>All investments involve risk, including the possible loss of principal. Past performance does not guarantee future results. Always conduct your own research and consult with qualified professionals before making any financial decisions. You assume full responsibility for any actions you take based on information found on this site.</p>
    </div>
    <p class="copyright">
      &copy; {new Date().getFullYear()} How To Win Capitalism &middot;
      <a href="/disclaimer/">Full Disclaimer</a> &middot;
      <a href="/privacy/">Privacy</a> &middot;
      <a href="/terms/">Terms</a>
    </p>
  </footer>

  <!-- User Menu (Login/Profile) -->
  <UserMenu />

  <!-- Cookie Consent -->
  <div id="cookie-consent" class="cookie-consent" hidden>
    <div class="cookie-message">
      <strong>Cookies:</strong> We use essential cookies for authentication and security. No advertising or tracking cookies.
    </div>
    <button id="cookie-accept" type="button">Got it</button>
  </div>

  <!-- Activity Tracking -->
  <script>
    import { trackPageView, isAuthenticated } from '../lib/auth';

    // Track page view if user is logged in
    if (typeof window !== 'undefined') {
      // Small delay to ensure auth state is loaded
      setTimeout(() => {
        if (isAuthenticated()) {
          trackPageView(window.location.pathname);
        }
      }, 100);
    }

    // Minimal cookie consent (essential-only)
    const consentKey = 'htwc_cookie_consent';
    const consentBanner = document.getElementById('cookie-consent');
    const consentButton = document.getElementById('cookie-accept');

    function hideConsent() {
      if (consentBanner) consentBanner.hidden = true;
    }

    if (typeof window !== 'undefined') {
      const consent = window.localStorage.getItem(consentKey);
      if (!consent && consentBanner) {
        consentBanner.hidden = false;
      }

      if (consentButton) {
        consentButton.addEventListener('click', () => {
          window.localStorage.setItem(consentKey, 'accepted');
          hideConsent();
        });
      }
    }
  </script>
</body>
</html>

<style is:global>
  /* Reset */
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  /* Base + Design Tokens */
  :root {
    /* Colors */
    --color-bg: #ffffff;
    --color-text: #202122;
    --color-text-muted: #666;
    --color-link: #0645ad;
    --color-link-visited: #0b0080;
    --color-border: #a2a9b1;
    --color-surface: #f8f9fa;
    --color-surface-alt: #eaecef;

    /* Warning/Info */
    --color-warning-bg: #fef6e7;
    --color-warning-border: #fc3;
    --color-info-bg: #eaf3ff;
    --color-info-border: #36c;

    /* Typography */
    --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    --font-serif: Georgia, "Times New Roman", serif;

    /* Sizes */
    --text-xs: 0.75rem;
    --text-sm: 0.875rem;
    --text-base: 1rem;
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;

    /* Spacing */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;

    /* Borders */
    --border-width: 1px;
    --line-height: 1.6;
    --line-height-tight: 1.3;

    /* Layout */
    --max-width: 800px;
  }

  html {
    font-family: var(--font-sans);
    font-size: 16px;
    line-height: 1.6;
    color: var(--color-text);
    background: var(--color-bg);
  }

  /* Typography */
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-serif);
    font-weight: 400;
    line-height: 1.3;
    margin: 1.5em 0 0.5em;
  }

  h1 { font-size: 2rem; }
  h2 { font-size: 1.5rem; border-bottom: 1px solid var(--color-border); padding-bottom: 0.25em; }
  h3 { font-size: 1.25rem; }

  p { margin: 1em 0; }

  a {
    color: var(--color-link);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  ul, ol {
    margin: 1em 0;
    padding-left: 2em;
  }

  code {
    background: var(--color-surface);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
  }

  pre {
    background: var(--color-surface);
    padding: 1em;
    overflow-x: auto;
    border-radius: 4px;
    margin: 1em 0;
  }

  pre code {
    background: none;
    padding: 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
  }

  th, td {
    border: 1px solid var(--color-border);
    padding: 0.5em;
    text-align: left;
  }

  th {
    background: var(--color-surface);
  }

  /* Layout */
  header {
    border-bottom: 1px solid var(--color-border);
    padding: 1rem;
  }

  header nav {
    max-width: var(--max-width);
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  header .site-title {
    font-family: var(--font-serif);
    font-size: 1.25rem;
    font-weight: 400;
    color: var(--color-text);
  }

  header ul {
    display: flex;
    gap: 1.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  header a.active {
    font-weight: 600;
  }

  header .nav-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  main {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  footer {
    border-top: 1px solid var(--color-border);
    padding: 2rem 1rem;
    color: #666;
    font-size: 0.875rem;
  }

  .footer-disclaimer {
    max-width: var(--max-width);
    margin: 0 auto 1.5rem;
    padding: 1.25rem;
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.8rem;
    line-height: 1.6;
    text-align: left;
  }

  .footer-disclaimer p {
    margin: 0 0 0.75rem 0;
  }

  .footer-disclaimer p:last-child {
    margin-bottom: 0;
  }

  .copyright {
    text-align: center;
    margin: 0;
  }

  .copyright a {
    color: var(--color-link);
  }

  .cookie-consent {
    position: fixed;
    bottom: var(--space-md);
    left: 50%;
    transform: translateX(-50%);
    max-width: 720px;
    width: calc(100% - 2 * var(--space-md));
    background: var(--color-surface);
    color: var(--color-text);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    padding: var(--space-md);
    display: flex;
    gap: var(--space-md);
    align-items: center;
    box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
    z-index: 1000;
  }

  .cookie-consent .cookie-message {
    flex: 1;
    font-size: var(--text-sm);
  }

  .cookie-consent button {
    background: var(--color-link);
    color: #fff;
    border: none;
    padding: 0.5rem 0.9rem;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
  }

  .cookie-consent button:hover {
    background: #053a92;
  }

  /* Responsive */
  @media (max-width: 600px) {
    header nav {
      flex-direction: column;
      text-align: center;
    }

    header ul {
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }

    header .nav-actions {
      width: 100%;
      justify-content: center;
      margin-top: 0.5rem;
    }
  }

  /* === Component Styles === */

  /* Breadcrumbs */
  .breadcrumbs {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-md);
  }

  .breadcrumbs__list {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: var(--space-xs);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .breadcrumbs__item {
    display: inline-flex;
    align-items: baseline;
    gap: var(--space-xs);
  }

  .breadcrumbs__separator {
    color: var(--color-text-muted);
  }

  .breadcrumbs__link {
    color: var(--color-link);
  }

  .breadcrumbs__link:visited {
    color: var(--color-link-visited);
  }

  .breadcrumbs__current {
    color: var(--color-text);
  }

  /* WikiBox */
  .wiki-box {
    display: flex;
    flex-direction: column;
    background: var(--color-bg);
    border: var(--border-width) solid var(--color-border);
    margin: var(--space-lg) 0;
  }

  .wiki-box__header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    background: var(--color-surface);
    padding: var(--space-md);
    border-bottom: var(--border-width) solid var(--color-border);
    font-weight: 600;
  }

  .wiki-box__title { flex: 1; }
  .wiki-box__body { padding: var(--space-md); }

  .wiki-box--padding-none .wiki-box__body { padding: 0; }
  .wiki-box--padding-sm .wiki-box__body { padding: var(--space-sm); }
  .wiki-box--padding-lg .wiki-box__body { padding: var(--space-lg); }

  .wiki-box--warning {
    background: var(--color-warning-bg);
    border-color: var(--color-warning-border);
    border-left-width: 4px;
  }

  .wiki-box--info {
    background: var(--color-info-bg);
    border-color: var(--color-info-border);
  }

  /* Disclaimer */
  .disclaimer-wrapper {
    position: relative;
  }

  .disclaimer-wrapper[hidden] {
    display: none;
  }

  .disclaimer-content {
    display: flex;
    align-items: flex-start;
    gap: var(--space-md);
    padding-right: 2rem;
  }

  .disclaimer-text {
    flex: 1;
  }

  .disclaimer-close {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    background: none;
    border: none;
    color: #000;
    cursor: pointer;
    font-size: 1.25rem;
    font-weight: bold;
    padding: 0.25rem 0.5rem;
    opacity: 0.6;
  }

  .disclaimer-close:hover {
    opacity: 1;
  }

  /* Topic Cards */
  .topic-card {
    display: block;
    text-decoration: none;
    color: inherit;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: var(--space-md) var(--space-lg);
    background: #fafafa;
    transition: all 0.15s ease;
    position: relative;
  }

  .topic-card:hover {
    border-color: var(--color-link);
    background: white;
  }

  .topic-card__inner {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .topic-card__header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: wrap;
  }

  .topic-card__tag {
    display: inline-block;
    background: #333;
    color: white;
    font-size: 0.6rem;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 700;
  }

  .topic-card__title {
    font-family: var(--font-serif);
    font-size: 1.1rem;
    font-weight: 400;
    margin: 0;
    color: var(--color-link);
  }

  .topic-card:hover .topic-card__title {
    text-decoration: underline;
  }

  .topic-card__description {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    margin: 0;
    line-height: 1.5;
  }

  /* Arrow indicator */
  .topic-card::after {
    content: "â†’";
    position: absolute;
    right: var(--space-lg);
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-link);
    font-size: 1.25rem;
    opacity: 0.5;
    transition: opacity 0.15s;
  }

  .topic-card:hover::after {
    opacity: 1;
  }

  /* Card Grid */
  .card-grid {
    display: grid;
    width: 100%;
    gap: var(--space-sm);
    grid-template-columns: 1fr;
  }

  @media (min-width: 640px) {
    .card-grid { grid-template-columns: repeat(2, 1fr); }
  }

  .card-grid .topic-card {
    margin: 0;
  }

  /* See Also */
  .see-also {
    margin: var(--space-xl) 0;
    padding-top: var(--space-lg);
    border-top: var(--border-width) solid var(--color-border);
  }

  .see-also__title {
    font-family: var(--font-serif);
    font-size: var(--text-xl);
    font-weight: 400;
    margin: 0 0 var(--space-md) 0;
    padding-bottom: var(--space-xs);
    border-bottom: var(--border-width) solid var(--color-border);
  }

  .see-also__list {
    list-style: disc;
    margin: 0;
    padding-left: var(--space-xl);
  }

  .see-also__item {
    margin-bottom: var(--space-sm);
  }

  .see-also__link {
    color: var(--color-link);
  }

  .see-also__link:visited {
    color: var(--color-link-visited);
  }

  .see-also__description {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
  }

  /* First h1 shouldn't have top margin */
  main > article > h1:first-child,
  main > h1:first-child {
    margin-top: 0;
  }

  @media print {
    .breadcrumbs { display: none; }
  }
</style>
